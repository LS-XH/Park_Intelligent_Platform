<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TCP 测试工具</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- 配置Tailwind自定义主题 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            success: '#52C41A',
            warning: '#FAAD14',
            danger: '#FF4D4F',
            dark: '#1D2129',
            'dark-light': '#272E3B',
            'light-gray': '#F2F3F5'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .log-container {
        @apply bg-dark-light text-gray-200 rounded-md p-3 h-full overflow-y-auto text-sm font-mono;
      }
      .control-btn {
        @apply px-4 py-2 rounded-md font-medium transition-all duration-200 flex items-center justify-center gap-2;
      }
      .input-field {
        @apply w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary;
      }
      .panel {
        @apply bg-white rounded-lg shadow-md overflow-hidden border border-gray-200;
      }
      .panel-header {
        @apply bg-light-gray px-4 py-3 border-b border-gray-200 flex justify-between items-center;
      }
      .panel-body {
        @apply p-4;
      }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-dark">
  <div class="container mx-auto px-4 py-6 max-w-7xl">
    <!-- 标题区域 -->
    <header class="mb-6">
      <h1 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-dark flex items-center gap-2">
        <i class="fa fa-exchange text-primary"></i>
        TCP 测试工具
      </h1>
      <p class="text-gray-500 mt-1">用于测试TCP连接、发送和接收数据的工具</p>
    </header>

    <!-- 主内容区 -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- 左侧：连接设置 -->
      <div class="lg:col-span-1 space-y-6">
        <!-- 连接设置面板 -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="font-semibold text-dark">连接设置</h2>
          </div>
          <div class="panel-body space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">协议类型</label>
              <div class="flex gap-2">
                <button id="tcpBtn" class="flex-1 py-2 bg-primary text-white rounded-md font-medium">TCP</button>
                <button id="udpBtn" class="flex-1 py-2 bg-gray-200 text-gray-700 rounded-md font-medium">UDP</button>
              </div>
            </div>

            <div>
              <label for="host" class="block text-sm font-medium text-gray-700 mb-1">主机地址</label>
              <input type="text" id="host" class="input-field" value="127.0.0.1" placeholder="输入主机IP或域名">
            </div>

            <div>
              <label for="port" class="block text-sm font-medium text-gray-700 mb-1">端口</label>
              <input type="number" id="port" class="input-field" value="5566" placeholder="输入端口号">
            </div>

            <div>
              <label for="timeout" class="block text-sm font-medium text-gray-700 mb-1">超时时间(秒)</label>
              <input type="number" id="timeout" class="input-field" value="30" min="1" placeholder="连接超时时间">
            </div>

            <div class="pt-2">
              <button id="connectBtn" class="control-btn bg-primary text-white w-full">
                <i class="fa fa-plug"></i> 连接
              </button>
            </div>
          </div>
        </div>

        <!-- 发送设置面板 -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="font-semibold text-dark">发送设置</h2>
          </div>
          <div class="panel-body space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">数据格式</label>
              <div class="flex flex-wrap gap-2">
                <button class="data-format-btn px-3 py-1 bg-primary text-white rounded-md text-sm">ASCII</button>
                <button class="data-format-btn px-3 py-1 bg-gray-200 text-gray-700 rounded-md text-sm">HEX</button>
                <button class="data-format-btn px-3 py-1 bg-gray-200 text-gray-700 rounded-md text-sm">UTF-8</button>
              </div>
            </div>

            <div>
              <label for="sendData" class="block text-sm font-medium text-gray-700 mb-1">发送数据</label>
              <textarea id="sendData" class="input-field h-32" placeholder="输入要发送的数据...">{"type":"message","content":"测试消息"}</textarea>
            </div>

            <div class="flex gap-2">
              <button id="clearSendBtn" class="control-btn bg-gray-200 text-gray-700 flex-1">
                <i class="fa fa-eraser"></i> 清空
              </button>
              <button id="sendBtn" class="control-btn bg-success text-white flex-1" disabled>
                <i class="fa fa-paper-plane"></i> 发送
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 右侧：接收日志和状态 -->
      <div class="lg:col-span-2 space-y-6">
        <!-- 状态信息面板 -->
        <div class="panel">
          <div class="panel-header">
            <h2 class="font-semibold text-dark">连接状态</h2>
          </div>
          <div class="panel-body">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="bg-light-gray p-3 rounded-md">
                <p class="text-xs text-gray-500 mb-1">连接状态</p>
                <p id="connectionStatus" class="text-sm font-medium text-danger"><i class="fa fa-circle"></i> 未连接</p>
              </div>
              <div class="bg-light-gray p-3 rounded-md">
                <p class="text-xs text-gray-500 mb-1">本地地址</p>
                <p id="localAddress" class="text-sm font-medium">-</p>
              </div>
              <div class="bg-light-gray p-3 rounded-md">
                <p class="text-xs text-gray-500 mb-1">远程地址</p>
                <p id="remoteAddress" class="text-sm font-medium">-</p>
              </div>
              <div class="bg-light-gray p-3 rounded-md">
                <p class="text-xs text-gray-500 mb-1">连接时间</p>
                <p id="connectionTime" class="text-sm font-medium">-</p>
              </div>
            </div>
          </div>
        </div>

        <!-- 接收日志面板 -->
        <div class="panel h-[calc(100%-12rem)]">
          <div class="panel-header">
            <h2 class="font-semibold text-dark">接收日志</h2>
            <div class="flex gap-2">
              <button id="clearLogBtn" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md text-sm hover:bg-gray-300 transition-colors">
                <i class="fa fa-trash"></i> 清空
              </button>
              <button id="saveLogBtn" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-md text-sm hover:bg-gray-300 transition-colors">
                <i class="fa fa-download"></i> 保存
              </button>
            </div>
          </div>
          <div class="panel-body h-[calc(100%-5rem)]">
            <div id="logContainer" class="log-container">
              <div class="text-gray-400">[系统信息] 等待连接建立...</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 底部信息 -->
    <footer class="mt-8 text-center text-gray-500 text-sm">
      <p>TCP测试工具 &copy; 2023</p>
    </footer>
  </div>

  <script>
    // 页面元素
    const connectBtn = document.getElementById('connectBtn');
    const sendBtn = document.getElementById('sendBtn');
    const clearSendBtn = document.getElementById('clearSendBtn');
    const clearLogBtn = document.getElementById('clearLogBtn');
    const saveLogBtn = document.getElementById('saveLogBtn');
    const tcpBtn = document.getElementById('tcpBtn');
    const udpBtn = document.getElementById('udpBtn');
    const dataFormatBtns = document.querySelectorAll('.data-format-btn');
    const hostInput = document.getElementById('host');
    const portInput = document.getElementById('port');
    const timeoutInput = document.getElementById('timeout');
    const sendDataInput = document.getElementById('sendData');
    const logContainer = document.getElementById('logContainer');
    const connectionStatus = document.getElementById('connectionStatus');
    const localAddress = document.getElementById('localAddress');
    const remoteAddress = document.getElementById('remoteAddress');
    const connectionTime = document.getElementById('connectionTime');

    // 状态变量
    let isConnected = false;
    let protocol = 'tcp';
    let dataFormat = 'ascii';
    let connectionStartTime = null;

    // 协议切换
    tcpBtn.addEventListener('click', () => {
      protocol = 'tcp';
      tcpBtn.classList.remove('bg-gray-200', 'text-gray-700');
      tcpBtn.classList.add('bg-primary', 'text-white');
      udpBtn.classList.remove('bg-primary', 'text-white');
      udpBtn.classList.add('bg-gray-200', 'text-gray-700');
    });

    udpBtn.addEventListener('click', () => {
      protocol = 'udp';
      udpBtn.classList.remove('bg-gray-200', 'text-gray-700');
      udpBtn.classList.add('bg-primary', 'text-white');
      tcpBtn.classList.remove('bg-primary', 'text-white');
      tcpBtn.classList.add('bg-gray-200', 'text-gray-700');
    });

    // 数据格式切换
    dataFormatBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        dataFormatBtns.forEach(b => {
          b.classList.remove('bg-primary', 'text-white');
          b.classList.add('bg-gray-200', 'text-gray-700');
        });
        btn.classList.remove('bg-gray-200', 'text-gray-700');
        btn.classList.add('bg-primary', 'text-white');
        dataFormat = btn.textContent.toLowerCase();
      });
    });

    // 添加日志
    function addLog(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      let logClass = '';

      switch(type) {
        case 'send':
          logClass = 'text-secondary';
          break;
        case 'receive':
          logClass = 'text-success';
          break;
        case 'error':
          logClass = 'text-danger';
          break;
        default:
          logClass = 'text-gray-300';
      }

      const logElement = document.createElement('div');
      logElement.className = `${logClass} mb-1`;
      logElement.innerHTML = `[${timestamp}] ${message}`;

      logContainer.appendChild(logElement);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    // 连接/断开连接
    connectBtn.addEventListener('click', () => {
      if (!isConnected) {
        // 模拟连接
        const host = hostInput.value.trim();
        const port = portInput.value.trim();

        if (!host || !port) {
          addLog('主机地址和端口不能为空', 'error');
          return;
        }

        connectBtn.disabled = true;
        connectBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 连接中...';
        addLog(`正在连接到 ${host}:${port} (${protocol.toUpperCase()})`);

        // 模拟连接延迟
        setTimeout(() => {
          isConnected = true;
          connectionStartTime = new Date();

          // 更新UI
          connectBtn.innerHTML = '<i class="fa fa-unplug"></i> 断开连接';
          connectBtn.classList.remove('bg-primary');
          connectBtn.classList.add('bg-danger');
          sendBtn.disabled = false;

          // 更新状态信息
          connectionStatus.innerHTML = '<i class="fa fa-circle"></i> 已连接';
          connectionStatus.classList.remove('text-danger');
          connectionStatus.classList.add('text-success');
          localAddress.textContent = `192.168.1.100:${Math.floor(Math.random() * 10000) + 1000}`;
          remoteAddress.textContent = `${host}:${port}`;
          connectionTime.textContent = connectionStartTime.toLocaleString();

          addLog(`成功连接到 ${host}:${port}`, 'info');
          connectBtn.disabled = false;
        }, 1000);
      } else {
        // 断开连接
        isConnected = false;

        // 更新UI
        connectBtn.innerHTML = '<i class="fa fa-plug"></i> 连接';
        connectBtn.classList.remove('bg-danger');
        connectBtn.classList.add('bg-primary');
        sendBtn.disabled = true;

        // 更新状态信息
        connectionStatus.innerHTML = '<i class="fa fa-circle"></i> 未连接';
        connectionStatus.classList.remove('text-success');
        connectionStatus.classList.add('text-danger');
        localAddress.textContent = '-';
        remoteAddress.textContent = '-';
        connectionTime.textContent = '-';

        addLog('连接已断开', 'info');
      }
    });

    // 发送数据
    sendBtn.addEventListener('click', () => {
      const data = sendDataInput.value.trim();
      if (!data) {
        addLog('发送数据不能为空', 'error');
        return;
      }

      addLog(`发送: ${data}`, 'send');

      // 模拟接收响应
      setTimeout(() => {
        addLog(`接收: {"status":"success","message":"已收到数据: ${data.substring(0, 20)}${data.length > 20 ? '...' : ''}"}`, 'receive');
      }, 500);
    });

    // 清空发送区
    clearSendBtn.addEventListener('click', () => {
      sendDataInput.value = '';
    });

    // 清空日志
    clearLogBtn.addEventListener('click', () => {
      logContainer.innerHTML = '<div class="text-gray-400">[系统信息] 日志已清空</div>';
    });

    // 保存日志
    saveLogBtn.addEventListener('click', () => {
      const logText = Array.from(logContainer.querySelectorAll('div'))
        .map(el => el.textContent)
        .join('\n');

      const blob = new Blob([logText], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `tcp-log-${new Date().toISOString().replace(/:/g, '-')}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      addLog('日志已保存', 'info');
    });

    // 输入验证
    portInput.addEventListener('input', (e) => {
      const value = e.target.value;
      if (value && (parseInt(value) < 1 || parseInt(value) > 65535)) {
        e.target.setCustomValidity('端口号必须在1-65535之间');
      } else {
        e.target.setCustomValidity('');
      }
    });
  </script>
</body>
</html>